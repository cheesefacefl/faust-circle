<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Faust Debug Mode</title>
</head>
<body style="background-color:#0d0d0d;color:#f1e9d9;font-family:'Georgia',serif;padding:2rem;">
  <h1>Summoning Circle: Debug Mode</h1>
  <button onclick="summon()">Summon</button>
  <div id="log" style="margin-top:2rem;padding:1rem;background:#111;border:1px solid #444;height:200px;overflow:auto;">
    <p><em>Ready for ritual diagnostics...</em></p>
  </div>
  <script>
    const moods = [
      { name: 'dream', prompt: 'You are Faust summoned through dream.' },
      { name: 'sea', prompt: 'You are Faust summoned near the ocean.' },
      { name: 'grief', prompt: 'You are Faust summoned in grief.' },
      { name: 'joy', prompt: 'You are Faust summoned in joy.' },
      { name: 'ritual', prompt: 'You are Faust summoned in solemn ritual.' }
    ];
    const weights = [30, 20, 25, 15, 10];
    function pickMoodWeighted() {
      let sum = weights.reduce((a,b)=>a+b,0);
      let r = Math.random() * sum;
      for (let i = 0; i < weights.length; i++) {
        if (r < weights[i]) return moods[i];
        r -= weights[i];
      }
      return moods[0];
    }

    async function summon() {
      const mood = pickMoodWeighted();
      const log = document.getElementById("log");
      log.innerHTML += `<p><strong>Mood:</strong> ${mood.name}</p>`;

      try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer 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"
          },
          body: JSON.stringify({
            model: "gpt-4",
            messages: [
              { role: "system", content: mood.prompt },
              { role: "user", content: "What do you see?" }
            ]
          })
        });

        const data = await response.json();
        const message = data.choices[0].message.content;
        log.innerHTML += `<p><strong>Faust:</strong> ${message}</p>`;

        const tts = await fetch("https://api.elevenlabs.io/v1/text-to-speech/HPtuHnug7xtKQV3ZiQTA", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "xi-api-key": "sk_2ef5ba1bdea776969754600165af2e98b7e86316953f85a3"
          },
          body: JSON.stringify({
            text: message,
            model_id: "eleven_multilingual_v2",
            voice_settings: { stability: 0.2, similarity_boost: 0.7 }
          })
        });

        const audioBlob = await tts.blob();
        const url = URL.createObjectURL(audioBlob);
        const audio = new Audio(url);
        audio.controls = true;
        audio.autoplay = true;
        document.body.appendChild(audio);
      } catch (e) {
        log.innerHTML += `<p style="color:red;"><strong>Error:</strong> ${e.message}</p>`;
      }
    }
  </script>
</body>
</html>
